"use strict";

var _extends = function (child, parent) {
  child.prototype = Object.create(parent.prototype, {
    constructor: {
      value: child,
      enumerable: false,
      writable: true,
      configurable: true
    }
  });
  child.__proto__ = parent;
};

jest.autoMockOff();
require('6to5/polyfill');

var annotate = require('../index').annotate;
var hasAnnotation = require('../index').hasAnnotation;
var readAnnotations = require('../index').readAnnotations;
var Injector = require('../index').Injector;
var Inject = require('../index').Inject;
var InjectLazy = require('../index').InjectLazy;
var InjectPromise = require('../index').InjectPromise;
var Provide = require('../index').Provide;
var ProvidePromise = require('../index').ProvidePromise;
var TransientScope = require('../index').TransientScope;
var UserList = function UserList() {};

// An async provider.
annotate(fetchUsers, new ProvidePromise(UserList));
function fetchUsers() {
  return Promise.resolve(new UserList());
}

var SynchronousUserList = function SynchronousUserList() {};

var UserController = function UserController(list) {
  this.list = list;
};

annotate(UserController, new Inject(UserList));

var SmartUserController = function SmartUserController(promise) {
  this.promise = promise;
};

annotate(SmartUserController, new InjectPromise(UserList));

describe("async", function () {
  it("should return a promise", function () {
    var injector = new Injector([fetchUsers]);
    var p = injector.getPromise(UserList);

    expect(p).toBePromiseLike();
  });

  it("should throw when instantiating promise provider synchronously", function () {
    var injector = new Injector([fetchUsers]);

    expect(function () {
      return injector.get(UserList);
    }).toThrowError("Cannot instantiate UserList synchronously. It is provided as a promise!");
  });

  it("should return promise even if the provider is sync", function () {
    var injector = new Injector();
    var p = injector.getPromise(SynchronousUserList);

    expect(p).toBePromiseLike();
  });

  // regression
  it("should return promise even if the provider is sync, from cache", function () {
    var injector = new Injector();
    var p1 = injector.getPromise(SynchronousUserList);
    var p2 = injector.getPromise(SynchronousUserList);

    expect(p2).toBePromiseLike();
  });

  pit("should return promise when a dependency is async", function () {
    var injector = new Injector([fetchUsers]);

    return injector.getPromise(UserController).then(function (userController) {
      expect(userController).toBeInstanceOf(UserController);
      expect(userController.list).toBeInstanceOf(UserList);
    });
  });

  // regression
  it("should return a promise even from parent injector", function () {
    var injector = new Injector([SynchronousUserList]);
    var childInjector = injector.createChild([]);

    expect(childInjector.getPromise(SynchronousUserList)).toBePromiseLike();
  });

  it("should throw when a dependency is async", function () {
    var injector = new Injector([fetchUsers]);

    expect(function () {
      return injector.get(UserController);
    }).toThrowError("Cannot instantiate UserList synchronously. It is provided as a promise! (UserController -> UserList)");
  });

  it("should resolve synchronously when async dependency requested as a promise", function () {
    var injector = new Injector([fetchUsers]);
    var controller = injector.get(SmartUserController);

    expect(controller).toBeInstanceOf(SmartUserController);
    expect(controller.promise).toBePromiseLike();
  });

  // regression
  pit("should not cache TransientScope", function () {
    var NeverCachedUserController = function NeverCachedUserController(list) {
      this.list = list;
    };

    annotate(NeverCachedUserController, new TransientScope());
    annotate(NeverCachedUserController, new Inject(UserList));

    var injector = new Injector([fetchUsers]);

    return injector.getPromise(NeverCachedUserController).then(function (controller1) {
      injector.getPromise(NeverCachedUserController).then(function (controller2) {
        expect(controller1).not.toBe(controller2);
      });
    });
  });

  pit("should allow async dependency in a parent constructor", function () {
    var ChildUserController = (function (UserController) {
      var ChildUserController = function ChildUserController() {
        UserController.apply(this, arguments);
      };

      _extends(ChildUserController, UserController);

      return ChildUserController;
    })(UserController);

    var injector = new Injector([fetchUsers]);

    return injector.getPromise(ChildUserController).then(function (childUserController) {
      expect(childUserController).toBeInstanceOf(ChildUserController);
      expect(childUserController.list).toBeInstanceOf(UserList);
    });
  });
});
//# sourceMappingURL=data:application/json;base64,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akYsWUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUMsY0FBYyxDQUFDLG1CQUFtQixDQUFDLENBQUE7QUFDL0QsWUFBTSxDQUFDLG1CQUFtQixDQUFDLElBQUksQ0FBQyxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQTtLQUMxRCxDQUFDLENBQUE7R0FDSCxDQUFDLENBQUE7Q0FDSCxDQUFDLENBQUEiLCJmaWxlIjoiX190ZXN0c19fL2FzeW5jLmpzIiwic291cmNlc0NvbnRlbnQiOlsiamVzdC5hdXRvTW9ja09mZigpXG5pbXBvcnQgJzZ0bzUvcG9seWZpbGwnXG5cbmltcG9ydCB7XG4gIGFubm90YXRlLFxuICBoYXNBbm5vdGF0aW9uLFxuICByZWFkQW5ub3RhdGlvbnMsXG4gIEluamVjdG9yLFxuICBJbmplY3QsXG4gIEluamVjdExhenksXG4gIEluamVjdFByb21pc2UsXG4gIFByb3ZpZGUsXG4gIFByb3ZpZGVQcm9taXNlLFxuICBUcmFuc2llbnRTY29wZVxufSBmcm9tICcuLi9pbmRleCdcblxuY2xhc3MgVXNlckxpc3Qge31cblxuLy8gQW4gYXN5bmMgcHJvdmlkZXIuXG5hbm5vdGF0ZShmZXRjaFVzZXJzLCBuZXcgUHJvdmlkZVByb21pc2UoVXNlckxpc3QpKVxuZnVuY3Rpb24gZmV0Y2hVc2VycygpIHtcbiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgVXNlckxpc3QpXG59XG5cbmNsYXNzIFN5bmNocm9ub3VzVXNlckxpc3Qge31cblxuY2xhc3MgVXNlckNvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3RvcihsaXN0KSB7XG4gICAgdGhpcy5saXN0ID0gbGlzdFxuICB9XG59XG5hbm5vdGF0ZShVc2VyQ29udHJvbGxlciwgbmV3IEluamVjdChVc2VyTGlzdCkpXG5cbmNsYXNzIFNtYXJ0VXNlckNvbnRyb2xsZXIge1xuICBjb25zdHJ1Y3Rvcihwcm9taXNlKSB7XG4gICAgdGhpcy5wcm9taXNlID0gcHJvbWlzZVxuICB9XG59XG5hbm5vdGF0ZShTbWFydFVzZXJDb250cm9sbGVyLCBuZXcgSW5qZWN0UHJvbWlzZShVc2VyTGlzdCkpXG5cbmRlc2NyaWJlKCdhc3luYycsIGZ1bmN0aW9uKCkge1xuXG4gIGl0KCdzaG91bGQgcmV0dXJuIGEgcHJvbWlzZScsIGZ1bmN0aW9uKCkge1xuICAgIHZhciBpbmplY3RvciA9IG5ldyBJbmplY3RvcihbZmV0Y2hVc2Vyc10pXG4gICAgdmFyIHAgPSBpbmplY3Rvci5nZXRQcm9taXNlKFVzZXJMaXN0KVxuXG4gICAgZXhwZWN0KHApLnRvQmVQcm9taXNlTGlrZSgpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCB0aHJvdyB3aGVuIGluc3RhbnRpYXRpbmcgcHJvbWlzZSBwcm92aWRlciBzeW5jaHJvbm91c2x5JywgZnVuY3Rpb24oKSB7XG4gICAgdmFyIGluamVjdG9yID0gbmV3IEluamVjdG9yKFtmZXRjaFVzZXJzXSlcblxuICAgIGV4cGVjdCgoKSA9PiBpbmplY3Rvci5nZXQoVXNlckxpc3QpKVxuICAgICAgICAudG9UaHJvd0Vycm9yKCdDYW5ub3QgaW5zdGFudGlhdGUgVXNlckxpc3Qgc3luY2hyb25vdXNseS4gSXQgaXMgcHJvdmlkZWQgYXMgYSBwcm9taXNlIScpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCByZXR1cm4gcHJvbWlzZSBldmVuIGlmIHRoZSBwcm92aWRlciBpcyBzeW5jJywgZnVuY3Rpb24oKSB7XG4gICAgdmFyIGluamVjdG9yID0gbmV3IEluamVjdG9yKClcbiAgICB2YXIgcCA9IGluamVjdG9yLmdldFByb21pc2UoU3luY2hyb25vdXNVc2VyTGlzdClcblxuICAgIGV4cGVjdChwKS50b0JlUHJvbWlzZUxpa2UoKVxuICB9KVxuXG4gIC8vIHJlZ3Jlc3Npb25cbiAgaXQoJ3Nob3VsZCByZXR1cm4gcHJvbWlzZSBldmVuIGlmIHRoZSBwcm92aWRlciBpcyBzeW5jLCBmcm9tIGNhY2hlJywgZnVuY3Rpb24oKSB7XG4gICAgdmFyIGluamVjdG9yID0gbmV3IEluamVjdG9yKClcbiAgICB2YXIgcDEgPSBpbmplY3Rvci5nZXRQcm9taXNlKFN5bmNocm9ub3VzVXNlckxpc3QpXG4gICAgdmFyIHAyID0gaW5qZWN0b3IuZ2V0UHJvbWlzZShTeW5jaHJvbm91c1VzZXJMaXN0KVxuXG4gICAgZXhwZWN0KHAyKS50b0JlUHJvbWlzZUxpa2UoKVxuICB9KVxuXG4gIHBpdCgnc2hvdWxkIHJldHVybiBwcm9taXNlIHdoZW4gYSBkZXBlbmRlbmN5IGlzIGFzeW5jJywgZnVuY3Rpb24oKSB7XG4gICAgdmFyIGluamVjdG9yID0gbmV3IEluamVjdG9yKFtmZXRjaFVzZXJzXSlcblxuICAgIHJldHVybiBpbmplY3Rvci5nZXRQcm9taXNlKFVzZXJDb250cm9sbGVyKS50aGVuKGZ1bmN0aW9uKHVzZXJDb250cm9sbGVyKSB7XG4gICAgICBleHBlY3QodXNlckNvbnRyb2xsZXIpLnRvQmVJbnN0YW5jZU9mKFVzZXJDb250cm9sbGVyKVxuICAgICAgZXhwZWN0KHVzZXJDb250cm9sbGVyLmxpc3QpLnRvQmVJbnN0YW5jZU9mKFVzZXJMaXN0KVxuICAgIH0pXG4gIH0pXG5cbiAgLy8gcmVncmVzc2lvblxuICBpdCgnc2hvdWxkIHJldHVybiBhIHByb21pc2UgZXZlbiBmcm9tIHBhcmVudCBpbmplY3RvcicsIGZ1bmN0aW9uKCkge1xuICAgIHZhciBpbmplY3RvciA9IG5ldyBJbmplY3RvcihbU3luY2hyb25vdXNVc2VyTGlzdF0pXG4gICAgdmFyIGNoaWxkSW5qZWN0b3IgPSBpbmplY3Rvci5jcmVhdGVDaGlsZChbXSlcblxuICAgIGV4cGVjdChjaGlsZEluamVjdG9yLmdldFByb21pc2UoU3luY2hyb25vdXNVc2VyTGlzdCkpLnRvQmVQcm9taXNlTGlrZSgpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCB0aHJvdyB3aGVuIGEgZGVwZW5kZW5jeSBpcyBhc3luYycsIGZ1bmN0aW9uKCkge1xuICAgIHZhciBpbmplY3RvciA9IG5ldyBJbmplY3RvcihbZmV0Y2hVc2Vyc10pXG5cbiAgICBleHBlY3QoKCkgPT4gaW5qZWN0b3IuZ2V0KFVzZXJDb250cm9sbGVyKSlcbiAgICAgICAgLnRvVGhyb3dFcnJvcignQ2Fubm90IGluc3RhbnRpYXRlIFVzZXJMaXN0IHN5bmNocm9ub3VzbHkuIEl0IGlzIHByb3ZpZGVkIGFzIGEgcHJvbWlzZSEgKFVzZXJDb250cm9sbGVyIC0+IFVzZXJMaXN0KScpXG4gIH0pXG5cbiAgaXQoJ3Nob3VsZCByZXNvbHZlIHN5bmNocm9ub3VzbHkgd2hlbiBhc3luYyBkZXBlbmRlbmN5IHJlcXVlc3RlZCBhcyBhIHByb21pc2UnLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgaW5qZWN0b3IgPSBuZXcgSW5qZWN0b3IoW2ZldGNoVXNlcnNdKVxuICAgIHZhciBjb250cm9sbGVyID0gaW5qZWN0b3IuZ2V0KFNtYXJ0VXNlckNvbnRyb2xsZXIpXG5cbiAgICBleHBlY3QoY29udHJvbGxlcikudG9CZUluc3RhbmNlT2YoU21hcnRVc2VyQ29udHJvbGxlcilcbiAgICBleHBlY3QoY29udHJvbGxlci5wcm9taXNlKS50b0JlUHJvbWlzZUxpa2UoKVxuICB9KVxuXG4gIC8vIHJlZ3Jlc3Npb25cbiAgcGl0KCdzaG91bGQgbm90IGNhY2hlIFRyYW5zaWVudFNjb3BlJywgZnVuY3Rpb24oKSB7XG5cbiAgICBjbGFzcyBOZXZlckNhY2hlZFVzZXJDb250cm9sbGVyIHtcbiAgICAgIGNvbnN0cnVjdG9yKGxpc3QpIHtcbiAgICAgICAgdGhpcy5saXN0ID0gbGlzdFxuICAgICAgfVxuICAgIH1cbiAgICBhbm5vdGF0ZShOZXZlckNhY2hlZFVzZXJDb250cm9sbGVyLCBuZXcgVHJhbnNpZW50U2NvcGUpXG4gICAgYW5ub3RhdGUoTmV2ZXJDYWNoZWRVc2VyQ29udHJvbGxlciwgbmV3IEluamVjdChVc2VyTGlzdCkpXG5cbiAgICB2YXIgaW5qZWN0b3IgPSBuZXcgSW5qZWN0b3IoW2ZldGNoVXNlcnNdKVxuXG4gICAgcmV0dXJuIGluamVjdG9yLmdldFByb21pc2UoTmV2ZXJDYWNoZWRVc2VyQ29udHJvbGxlcikudGhlbihmdW5jdGlvbihjb250cm9sbGVyMSkge1xuICAgICAgaW5qZWN0b3IuZ2V0UHJvbWlzZShOZXZlckNhY2hlZFVzZXJDb250cm9sbGVyKS50aGVuKGZ1bmN0aW9uKGNvbnRyb2xsZXIyKSB7XG4gICAgICAgIGV4cGVjdChjb250cm9sbGVyMSkubm90LnRvQmUoY29udHJvbGxlcjIpXG4gICAgICB9KVxuICAgIH0pXG4gIH0pXG5cbiAgcGl0KCdzaG91bGQgYWxsb3cgYXN5bmMgZGVwZW5kZW5jeSBpbiBhIHBhcmVudCBjb25zdHJ1Y3RvcicsIGZ1bmN0aW9uKCkge1xuICAgIGNsYXNzIENoaWxkVXNlckNvbnRyb2xsZXIgZXh0ZW5kcyBVc2VyQ29udHJvbGxlciB7fVxuXG4gICAgdmFyIGluamVjdG9yID0gbmV3IEluamVjdG9yKFtmZXRjaFVzZXJzXSlcblxuICAgIHJldHVybiBpbmplY3Rvci5nZXRQcm9taXNlKENoaWxkVXNlckNvbnRyb2xsZXIpLnRoZW4oZnVuY3Rpb24oY2hpbGRVc2VyQ29udHJvbGxlcikge1xuICAgICAgZXhwZWN0KGNoaWxkVXNlckNvbnRyb2xsZXIpLnRvQmVJbnN0YW5jZU9mKENoaWxkVXNlckNvbnRyb2xsZXIpXG4gICAgICBleHBlY3QoY2hpbGRVc2VyQ29udHJvbGxlci5saXN0KS50b0JlSW5zdGFuY2VPZihVc2VyTGlzdClcbiAgICB9KVxuICB9KVxufSlcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==