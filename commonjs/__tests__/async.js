"use strict";

var _extends = function (child, parent) {
  child.prototype = Object.create(parent.prototype, {
    constructor: {
      value: child,
      enumerable: false,
      writable: true,
      configurable: true
    }
  });
  child.__proto__ = parent;
};

jest.autoMockOff();
require('6to5/polyfill');

var annotate = require('../index').annotate;
var Injector = require('../index').Injector;
var Inject = require('../index').Inject;
var InjectPromise = require('../index').InjectPromise;
var ProvidePromise = require('../index').ProvidePromise;
var TransientScope = require('../index').TransientScope;
var UserList = function UserList() {};

// An async provider.
annotate(fetchUsers, new ProvidePromise(UserList));
function fetchUsers() {
  return Promise.resolve(new UserList());
}

var SynchronousUserList = function SynchronousUserList() {};

var UserController = function UserController(list) {
  this.list = list;
};

annotate(UserController, new Inject(UserList));

var SmartUserController = function SmartUserController(promise) {
  this.promise = promise;
};

annotate(SmartUserController, new InjectPromise(UserList));

describe("async", function () {
  it("should return a promise", function () {
    var injector = new Injector([fetchUsers]);
    var p = injector.getPromise(UserList);

    expect(p).toBePromiseLike();
  });

  it("should throw when instantiating promise provider synchronously", function () {
    var injector = new Injector([fetchUsers]);

    expect(function () {
      return injector.get(UserList);
    }).toThrowError("Cannot instantiate UserList synchronously. It is provided as a promise!");
  });

  it("should return promise even if the provider is sync", function () {
    var injector = new Injector();
    var p = injector.getPromise(SynchronousUserList);

    expect(p).toBePromiseLike();
  });

  // regression
  it("should return promise even if the provider is sync, from cache", function () {
    var injector = new Injector();
    /* jshint -W004 */
    var p1 = injector.getPromise(SynchronousUserList);
    var p1 = injector.getPromise(SynchronousUserList);
    /* jshint +W004 */

    expect(p1).toBePromiseLike();
  });

  pit("should return promise when a dependency is async", function () {
    var injector = new Injector([fetchUsers]);

    return injector.getPromise(UserController).then(function (userController) {
      expect(userController).toBeInstanceOf(UserController);
      expect(userController.list).toBeInstanceOf(UserList);
    });
  });

  // regression
  it("should return a promise even from parent injector", function () {
    var injector = new Injector([SynchronousUserList]);
    var childInjector = injector.createChild([]);

    expect(childInjector.getPromise(SynchronousUserList)).toBePromiseLike();
  });

  it("should throw when a dependency is async", function () {
    var injector = new Injector([fetchUsers]);

    expect(function () {
      return injector.get(UserController);
    }).toThrowError("Cannot instantiate UserList synchronously. It is provided as a promise! (UserController -> UserList)");
  });

  it("should resolve synchronously when async dependency requested as a promise", function () {
    var injector = new Injector([fetchUsers]);
    var controller = injector.get(SmartUserController);

    expect(controller).toBeInstanceOf(SmartUserController);
    expect(controller.promise).toBePromiseLike();
  });

  // regression
  pit("should not cache TransientScope", function () {
    var NeverCachedUserController = function NeverCachedUserController(list) {
      this.list = list;
    };

    annotate(NeverCachedUserController, new TransientScope());
    annotate(NeverCachedUserController, new Inject(UserList));

    var injector = new Injector([fetchUsers]);

    return injector.getPromise(NeverCachedUserController).then(function (controller1) {
      injector.getPromise(NeverCachedUserController).then(function (controller2) {
        expect(controller1).not.toBe(controller2);
      });
    });
  });

  pit("should allow async dependency in a parent constructor", function () {
    var ChildUserController = (function (UserController) {
      var ChildUserController = function ChildUserController() {
        UserController.apply(this, arguments);
      };

      _extends(ChildUserController, UserController);

      return ChildUserController;
    })(UserController);

    var injector = new Injector([fetchUsers]);

    return injector.getPromise(ChildUserController).then(function (childUserController) {
      expect(childUserController).toBeInstanceOf(ChildUserController);
      expect(childUserController.list).toBeInstanceOf(UserList);
    });
  });
});
//# sourceMappingURL=data:application/json;base64,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QUMsSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFBO0tBQzFELENBQUMsQ0FBQTtHQUNILENBQUMsQ0FBQTtDQUNILENBQUMsQ0FBQSIsImZpbGUiOiJfX3Rlc3RzX18vYXN5bmMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJqZXN0LmF1dG9Nb2NrT2ZmKClcbmltcG9ydCAnNnRvNS9wb2x5ZmlsbCdcblxuaW1wb3J0IHtcbiAgYW5ub3RhdGUsXG4gIEluamVjdG9yLFxuICBJbmplY3QsXG4gIEluamVjdFByb21pc2UsXG4gIFByb3ZpZGVQcm9taXNlLFxuICBUcmFuc2llbnRTY29wZVxufSBmcm9tICcuLi9pbmRleCdcblxuY2xhc3MgVXNlckxpc3Qge31cblxuLy8gQW4gYXN5bmMgcHJvdmlkZXIuXG5hbm5vdGF0ZShmZXRjaFVzZXJzLCBuZXcgUHJvdmlkZVByb21pc2UoVXNlckxpc3QpKVxuZnVuY3Rpb24gZmV0Y2hVc2VycygpIHtcbiAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShuZXcgVXNlckxpc3QoKSlcbn1cblxuY2xhc3MgU3luY2hyb25vdXNVc2VyTGlzdCB7fVxuXG5jbGFzcyBVc2VyQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKGxpc3QpIHtcbiAgICB0aGlzLmxpc3QgPSBsaXN0XG4gIH1cbn1cbmFubm90YXRlKFVzZXJDb250cm9sbGVyLCBuZXcgSW5qZWN0KFVzZXJMaXN0KSlcblxuY2xhc3MgU21hcnRVc2VyQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKHByb21pc2UpIHtcbiAgICB0aGlzLnByb21pc2UgPSBwcm9taXNlXG4gIH1cbn1cbmFubm90YXRlKFNtYXJ0VXNlckNvbnRyb2xsZXIsIG5ldyBJbmplY3RQcm9taXNlKFVzZXJMaXN0KSlcblxuZGVzY3JpYmUoJ2FzeW5jJywgZnVuY3Rpb24oKSB7XG5cbiAgaXQoJ3Nob3VsZCByZXR1cm4gYSBwcm9taXNlJywgZnVuY3Rpb24oKSB7XG4gICAgdmFyIGluamVjdG9yID0gbmV3IEluamVjdG9yKFtmZXRjaFVzZXJzXSlcbiAgICB2YXIgcCA9IGluamVjdG9yLmdldFByb21pc2UoVXNlckxpc3QpXG5cbiAgICBleHBlY3QocCkudG9CZVByb21pc2VMaWtlKClcbiAgfSlcblxuICBpdCgnc2hvdWxkIHRocm93IHdoZW4gaW5zdGFudGlhdGluZyBwcm9taXNlIHByb3ZpZGVyIHN5bmNocm9ub3VzbHknLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgaW5qZWN0b3IgPSBuZXcgSW5qZWN0b3IoW2ZldGNoVXNlcnNdKVxuXG4gICAgZXhwZWN0KCgpID0+IGluamVjdG9yLmdldChVc2VyTGlzdCkpXG4gICAgICAgIC50b1Rocm93RXJyb3IoJ0Nhbm5vdCBpbnN0YW50aWF0ZSBVc2VyTGlzdCBzeW5jaHJvbm91c2x5LiBJdCBpcyBwcm92aWRlZCBhcyBhIHByb21pc2UhJylcbiAgfSlcblxuICBpdCgnc2hvdWxkIHJldHVybiBwcm9taXNlIGV2ZW4gaWYgdGhlIHByb3ZpZGVyIGlzIHN5bmMnLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgaW5qZWN0b3IgPSBuZXcgSW5qZWN0b3IoKVxuICAgIHZhciBwID0gaW5qZWN0b3IuZ2V0UHJvbWlzZShTeW5jaHJvbm91c1VzZXJMaXN0KVxuXG4gICAgZXhwZWN0KHApLnRvQmVQcm9taXNlTGlrZSgpXG4gIH0pXG5cbiAgLy8gcmVncmVzc2lvblxuICBpdCgnc2hvdWxkIHJldHVybiBwcm9taXNlIGV2ZW4gaWYgdGhlIHByb3ZpZGVyIGlzIHN5bmMsIGZyb20gY2FjaGUnLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgaW5qZWN0b3IgPSBuZXcgSW5qZWN0b3IoKVxuICAgIC8qIGpzaGludCAtVzAwNCAqL1xuICAgIHZhciBwMSA9IGluamVjdG9yLmdldFByb21pc2UoU3luY2hyb25vdXNVc2VyTGlzdClcbiAgICB2YXIgcDEgPSBpbmplY3Rvci5nZXRQcm9taXNlKFN5bmNocm9ub3VzVXNlckxpc3QpXG4gICAgLyoganNoaW50ICtXMDA0ICovXG5cbiAgICBleHBlY3QocDEpLnRvQmVQcm9taXNlTGlrZSgpXG4gIH0pXG5cbiAgcGl0KCdzaG91bGQgcmV0dXJuIHByb21pc2Ugd2hlbiBhIGRlcGVuZGVuY3kgaXMgYXN5bmMnLCBmdW5jdGlvbigpIHtcbiAgICB2YXIgaW5qZWN0b3IgPSBuZXcgSW5qZWN0b3IoW2ZldGNoVXNlcnNdKVxuXG4gICAgcmV0dXJuIGluamVjdG9yLmdldFByb21pc2UoVXNlckNvbnRyb2xsZXIpLnRoZW4oZnVuY3Rpb24odXNlckNvbnRyb2xsZXIpIHtcbiAgICAgIGV4cGVjdCh1c2VyQ29udHJvbGxlcikudG9CZUluc3RhbmNlT2YoVXNlckNvbnRyb2xsZXIpXG4gICAgICBleHBlY3QodXNlckNvbnRyb2xsZXIubGlzdCkudG9CZUluc3RhbmNlT2YoVXNlckxpc3QpXG4gICAgfSlcbiAgfSlcblxuICAvLyByZWdyZXNzaW9uXG4gIGl0KCdzaG91bGQgcmV0dXJuIGEgcHJvbWlzZSBldmVuIGZyb20gcGFyZW50IGluamVjdG9yJywgZnVuY3Rpb24oKSB7XG4gICAgdmFyIGluamVjdG9yID0gbmV3IEluamVjdG9yKFtTeW5jaHJvbm91c1VzZXJMaXN0XSlcbiAgICB2YXIgY2hpbGRJbmplY3RvciA9IGluamVjdG9yLmNyZWF0ZUNoaWxkKFtdKVxuXG4gICAgZXhwZWN0KGNoaWxkSW5qZWN0b3IuZ2V0UHJvbWlzZShTeW5jaHJvbm91c1VzZXJMaXN0KSkudG9CZVByb21pc2VMaWtlKClcbiAgfSlcblxuICBpdCgnc2hvdWxkIHRocm93IHdoZW4gYSBkZXBlbmRlbmN5IGlzIGFzeW5jJywgZnVuY3Rpb24oKSB7XG4gICAgdmFyIGluamVjdG9yID0gbmV3IEluamVjdG9yKFtmZXRjaFVzZXJzXSlcblxuICAgIGV4cGVjdCgoKSA9PiBpbmplY3Rvci5nZXQoVXNlckNvbnRyb2xsZXIpKVxuICAgICAgICAudG9UaHJvd0Vycm9yKCdDYW5ub3QgaW5zdGFudGlhdGUgVXNlckxpc3Qgc3luY2hyb25vdXNseS4gSXQgaXMgcHJvdmlkZWQgYXMgYSBwcm9taXNlISAoVXNlckNvbnRyb2xsZXIgLT4gVXNlckxpc3QpJylcbiAgfSlcblxuICBpdCgnc2hvdWxkIHJlc29sdmUgc3luY2hyb25vdXNseSB3aGVuIGFzeW5jIGRlcGVuZGVuY3kgcmVxdWVzdGVkIGFzIGEgcHJvbWlzZScsIGZ1bmN0aW9uKCkge1xuICAgIHZhciBpbmplY3RvciA9IG5ldyBJbmplY3RvcihbZmV0Y2hVc2Vyc10pXG4gICAgdmFyIGNvbnRyb2xsZXIgPSBpbmplY3Rvci5nZXQoU21hcnRVc2VyQ29udHJvbGxlcilcblxuICAgIGV4cGVjdChjb250cm9sbGVyKS50b0JlSW5zdGFuY2VPZihTbWFydFVzZXJDb250cm9sbGVyKVxuICAgIGV4cGVjdChjb250cm9sbGVyLnByb21pc2UpLnRvQmVQcm9taXNlTGlrZSgpXG4gIH0pXG5cbiAgLy8gcmVncmVzc2lvblxuICBwaXQoJ3Nob3VsZCBub3QgY2FjaGUgVHJhbnNpZW50U2NvcGUnLCBmdW5jdGlvbigpIHtcblxuICAgIGNsYXNzIE5ldmVyQ2FjaGVkVXNlckNvbnRyb2xsZXIge1xuICAgICAgY29uc3RydWN0b3IobGlzdCkge1xuICAgICAgICB0aGlzLmxpc3QgPSBsaXN0XG4gICAgICB9XG4gICAgfVxuICAgIGFubm90YXRlKE5ldmVyQ2FjaGVkVXNlckNvbnRyb2xsZXIsIG5ldyBUcmFuc2llbnRTY29wZSgpKVxuICAgIGFubm90YXRlKE5ldmVyQ2FjaGVkVXNlckNvbnRyb2xsZXIsIG5ldyBJbmplY3QoVXNlckxpc3QpKVxuXG4gICAgdmFyIGluamVjdG9yID0gbmV3IEluamVjdG9yKFtmZXRjaFVzZXJzXSlcblxuICAgIHJldHVybiBpbmplY3Rvci5nZXRQcm9taXNlKE5ldmVyQ2FjaGVkVXNlckNvbnRyb2xsZXIpLnRoZW4oZnVuY3Rpb24oY29udHJvbGxlcjEpIHtcbiAgICAgIGluamVjdG9yLmdldFByb21pc2UoTmV2ZXJDYWNoZWRVc2VyQ29udHJvbGxlcikudGhlbihmdW5jdGlvbihjb250cm9sbGVyMikge1xuICAgICAgICBleHBlY3QoY29udHJvbGxlcjEpLm5vdC50b0JlKGNvbnRyb2xsZXIyKVxuICAgICAgfSlcbiAgICB9KVxuICB9KVxuXG4gIHBpdCgnc2hvdWxkIGFsbG93IGFzeW5jIGRlcGVuZGVuY3kgaW4gYSBwYXJlbnQgY29uc3RydWN0b3InLCBmdW5jdGlvbigpIHtcbiAgICBjbGFzcyBDaGlsZFVzZXJDb250cm9sbGVyIGV4dGVuZHMgVXNlckNvbnRyb2xsZXIge31cblxuICAgIHZhciBpbmplY3RvciA9IG5ldyBJbmplY3RvcihbZmV0Y2hVc2Vyc10pXG5cbiAgICByZXR1cm4gaW5qZWN0b3IuZ2V0UHJvbWlzZShDaGlsZFVzZXJDb250cm9sbGVyKS50aGVuKGZ1bmN0aW9uKGNoaWxkVXNlckNvbnRyb2xsZXIpIHtcbiAgICAgIGV4cGVjdChjaGlsZFVzZXJDb250cm9sbGVyKS50b0JlSW5zdGFuY2VPZihDaGlsZFVzZXJDb250cm9sbGVyKVxuICAgICAgZXhwZWN0KGNoaWxkVXNlckNvbnRyb2xsZXIubGlzdCkudG9CZUluc3RhbmNlT2YoVXNlckxpc3QpXG4gICAgfSlcbiAgfSlcbn0pXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=