{"version":3,"sources":["__tests__/async.js"],"names":[],"mappings":"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","file":"__tests__/async.js","sourcesContent":["jest.autoMockOff()\nimport '6to5/polyfill'\n\nimport {\n  annotate,\n  Injector,\n  Inject,\n  Type,\n  InjectPromise,\n  ProvidePromise,\n  TransientScope\n} from '../index'\n\nclass UserList {}\n\n// An async provider.\nannotate(fetchUsers, new ProvidePromise(UserList))\nfunction fetchUsers() {\n  return Promise.resolve(new UserList())\n}\n\nclass SynchronousUserList {}\n\nclass UserController {\n  constructor(list) {\n    this.list = list\n  }\n}\nannotate(UserController, new Type())\nannotate(UserController, new Inject(UserList))\n\nclass SmartUserController {\n  constructor(promise) {\n    this.promise = promise\n  }\n}\nannotate(SmartUserController, new Type())\nannotate(SmartUserController, new InjectPromise(UserList))\n\ndescribe('async', function() {\n\n  it('should return a promise', function() {\n    var injector = new Injector([fetchUsers])\n    var p = injector.getPromise(UserList)\n\n    expect(p).toBePromiseLike()\n  })\n\n  it('should throw when instantiating promise provider synchronously', function() {\n    var injector = new Injector([fetchUsers])\n\n    expect(() => injector.get(UserList))\n        .toThrowError('Cannot instantiate UserList synchronously. It is provided as a promise!')\n  })\n\n  it('should return promise even if the provider is sync', function() {\n    var injector = new Injector()\n    var p = injector.getPromise(SynchronousUserList)\n\n    expect(p).toBePromiseLike()\n  })\n\n  // regression\n  it('should return promise even if the provider is sync, from cache', function() {\n    var injector = new Injector()\n    /* jshint -W004 */\n    var p1 = injector.getPromise(SynchronousUserList)\n    var p1 = injector.getPromise(SynchronousUserList)\n    /* jshint +W004 */\n\n    expect(p1).toBePromiseLike()\n  })\n\n  pit('should return promise when a dependency is async', function() {\n    var injector = new Injector([fetchUsers])\n\n    return injector.getPromise(UserController).then(function(userController) {\n      expect(userController).toBeInstanceOf(UserController)\n      expect(userController.list).toBeInstanceOf(UserList)\n    })\n  })\n\n  // regression\n  it('should return a promise even from parent injector', function() {\n    var injector = new Injector([SynchronousUserList])\n    var childInjector = injector.createChild([])\n\n    expect(childInjector.getPromise(SynchronousUserList)).toBePromiseLike()\n  })\n\n  it('should throw when a dependency is async', function() {\n    var injector = new Injector([fetchUsers])\n\n    expect(() => injector.get(UserController))\n        .toThrowError('Cannot instantiate UserList synchronously. It is provided as a promise! (UserController -> UserList)')\n  })\n\n  it('should resolve synchronously when async dependency requested as a promise', function() {\n    var injector = new Injector([fetchUsers])\n    var controller = injector.get(SmartUserController)\n\n    expect(controller).toBeInstanceOf(SmartUserController)\n    expect(controller.promise).toBePromiseLike()\n  })\n\n  // regression\n  pit('should not cache TransientScope', function() {\n\n    class NeverCachedUserController {\n      constructor(list) {\n        this.list = list\n      }\n    }\n    annotate(NeverCachedUserController, new Type())\n    annotate(NeverCachedUserController, new TransientScope())\n    annotate(NeverCachedUserController, new Inject(UserList))\n\n    var injector = new Injector([fetchUsers])\n\n    return injector.getPromise(NeverCachedUserController).then(function(controller1) {\n      injector.getPromise(NeverCachedUserController).then(function(controller2) {\n        expect(controller1).not.toBe(controller2)\n      })\n    })\n  })\n\n  pit('should allow async dependency in a parent constructor', function() {\n    class ChildUserController extends UserController {}\n\n    var injector = new Injector([fetchUsers])\n\n    return injector.getPromise(ChildUserController).then(function(childUserController) {\n      expect(childUserController).toBeInstanceOf(ChildUserController)\n      expect(childUserController.list).toBeInstanceOf(UserList)\n    })\n  })\n})\n"],"sourceRoot":"/source/"}