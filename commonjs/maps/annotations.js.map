{"version":3,"sources":["annotations.js"],"names":[],"mappings":"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","file":"annotations.js","sourcesContent":["import {isFunction} from './util';\n\n\n// This module contains:\n// - built-in annotation classes\n// - helpers to read/write annotations\n\n\n// ANNOTATIONS\n\n// A built-in token.\n// Used to ask for pre-injected parent constructor.\n// A class constructor can ask for this.\nclass SuperConstructor {}\n\n// A built-in scope.\n// Never cache.\nclass TransientScope {}\n\nclass Inject {\n  constructor(...tokens) {\n    this.tokens = tokens;\n    this.isPromise = false;\n    this.isLazy = false;\n  }\n}\n\nclass InjectPromise extends Inject {\n  constructor(...tokens) {\n    this.tokens = tokens;\n    this.isPromise = true;\n    this.isLazy = false;\n  }\n}\n\nclass InjectLazy extends Inject {\n  constructor(...tokens) {\n    this.tokens = tokens;\n    this.isPromise = false;\n    this.isLazy = true;\n  }\n}\n\nclass Provide {\n  constructor(token) {\n    this.token = token;\n    this.isPromise = false;\n  }\n}\n\nclass ProvidePromise extends Provide {\n  constructor(token) {\n    this.token = token;\n    this.isPromise = true;\n  }\n}\n\n\n// HELPERS\n\n// Append annotation on a function or class.\n// This can be helpful when not using ES6+.\nfunction annotate(fn, annotation) {\n\n  if (fn.annotations === Object.getPrototypeOf(fn).annotations) {\n    fn.annotations = []\n  }\n\n  fn.annotations = fn.annotations || [];\n  fn.annotations.push(annotation);\n}\n\n\n// Read annotations on a function or class and return whether given annotation is present.\nfunction hasAnnotation(fn, annotationClass) {\n  if (!fn.annotations || fn.annotations.length === 0) {\n    return false;\n  }\n\n  for (var annotation of fn.annotations) {\n    if (annotation instanceof annotationClass) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n\n// Read annotations on a function or class and collect \"interesting\" metadata:\nfunction readAnnotations(fn) {\n  var collectedAnnotations = {\n    // Description of the provided value.\n    provide: {\n      token: null,\n      isPromise: false\n    },\n\n    // List of parameter descriptions.\n    // A parameter description is an object with properties:\n    // - token (anything)\n    // - isPromise (boolean)\n    // - isLazy (boolean)\n    params: []\n  };\n\n  if (fn.annotations && fn.annotations.length) {\n    for (var annotation of fn.annotations) {\n      if (annotation instanceof Inject) {\n        annotation.tokens.forEach((token) => {\n          collectedAnnotations.params.push({\n            token: token,\n            isPromise: annotation.isPromise,\n            isLazy: annotation.isLazy\n          });\n        });\n      }\n\n      if (annotation instanceof Provide) {\n        collectedAnnotations.provide.token = annotation.token;\n        collectedAnnotations.provide.isPromise = annotation.isPromise;\n      }\n    }\n  }\n\n  // Read annotations for individual parameters.\n  if (fn.parameters) {\n    fn.parameters.forEach((param, idx) => {\n      for (var paramAnnotation of param) {\n        // Type annotation.\n        if (isFunction(paramAnnotation) && !collectedAnnotations.params[idx]) {\n          collectedAnnotations.params[idx] = {\n            token: paramAnnotation,\n            isPromise: false,\n            isLazy: false\n          };\n        } else if (paramAnnotation instanceof Inject) {\n          collectedAnnotations.params[idx] = {\n            token: paramAnnotation.tokens[0],\n            isPromise: paramAnnotation.isPromise,\n            isLazy: paramAnnotation.isLazy\n          };\n        }\n      }\n    });\n  }\n\n  return collectedAnnotations;\n}\n\n\nexport {\n  annotate,\n  hasAnnotation,\n  readAnnotations,\n\n  SuperConstructor,\n  TransientScope,\n  Inject,\n  InjectPromise,\n  InjectLazy,\n  Provide,\n  ProvidePromise\n};\n"],"sourceRoot":"/source/"}